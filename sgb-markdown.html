<!--
Copyright 2014 Smörgåsbord Development. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../sgb-filedrop/sgb-filedrop.html"> 
<link rel="import" href="../sgb-markdownview/sgb-markdownview.html"> 

<polymer-element name="sgb-markdown" attributes="value placeholder uploadurl">

	<template>


		<style>

			:host {

				display: -moz-box;
				display: -ms-flexbox;
				display: -webkit-flex;
				display: flex;
				-ms-flex-direction: row;
				-webkit-flex-direction: row;
				flex-direction: row;			
			}

			#fileDropPanel {

			   -webkit-flex: 1;
		        flex: 1;
        		-ms-flex: 1;
			}			
	
			#previewPanel {

			   -webkit-flex: 1;
		        flex: 1;
        		-ms-flex: 1;
        		padding: 10px;
				overflow:auto;
        		border-left: 1px solid #dddddd;	/* Devider */
			}

			#fileDropPanel textarea {
				
				width: 100%;
				border: 0px;
				margin: 0px;
				padding: 10px;
				resize: none;
				background-color: transparent;
			}			
			
		</style>
		
		<sgb-filedrop id="fileDropPanel" url={{uploadurl}} value={{fileDrop}}>
			<textarea id="inputBox" value='{{value}}' placeholder="{{placeholder}}"></textarea>
		</sgb-filedrop>

		<sgb-markdownview id="previewPanel" value={{value}}></sgb-markdownview>
	</template>

	<script>

	    "use strict";

	    Polymer('sgb-markdown', {
	    	uploadurl: "",
	    	placeholder: "",
	    	value: "",
	    	options: {},		
	      	ready: function() {

				// event listener on fileDrop
				this.$.fileDropPanel.addEventListener('fileDrop', this.onFileDrop.bind(this));		
	      	},
	      
	      	onFileDrop: function(e) {

				var selectionStart = this.$.inputBox.selectionStart; 
				var selectionEnd = this.$.inputBox.selectionEnd; 

				var str1 = this.value.substring(0,selectionStart);
				var str2 = this.value.substring(selectionEnd);
				this.value = str1 + e.detail.mediaUrl + str2;
	      	}    	
	    });
	</script>
</polymer-element>
